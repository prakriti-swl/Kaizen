{% extends "base.html" %}
{% load static %}

{% block content %}

<!-- Products Hero -->
<section class="products-hero" id="products-start" style="background-image: url({% static 'img/background-img1.jpg' %});">
  <h2>Our Products</h2>
  <p>Explore our collection of high-quality cosmetics.</p>
</section>

<!-- Category Filter Buttons -->
<div class="category-filters">
  <button class="filter-btn {% if not active_category %}active{% endif %}" data-category="all">All</button>

  {% for category in categories %}
    <button class="filter-btn {% if active_category == category.id|stringformat:'s' %}active{% endif %}"
            data-category="{{ category.id }}">
      {{ category.name }}
    </button>
  {% endfor %}
</div>

<!-- Products Grid -->
{% for category in categories %}
<section class="category-section" data-category="{{ category.id }}">
  <h3 class="category-title">{{ category.name }}</h3>

  <div class="product-grid">
    {% for product in category.products.all %}
    <div class="product-card product-item">
      {% if product.status %}
        <span class="product-badge {{ product.status }}">{{ product.status|title }}</span>
      {% endif %}

      <a href="{% url 'product-detail' product.slug %}" class="product-link">
        <div class="product-image" style="background-image: url('{{ product.image.url }}');"></div>
      </a>

      <div class="product-actions">
        <a href="#" title="Add to Cart">üõí</a>
        <a href="{% url 'product-detail' product.slug %}" title="Details">üîç</a>
        <a href="#" title="Wishlist">‚ô°</a>
      </div>

      <div class="product-info">
        <div class="product-title-price">
          <a href="{% url 'product-detail' product.slug %}" class="product-name">{{ product.name }}</a>
          <span class="price">${{ product.price }}</span>
        </div>
      </div>
    </div>
    {% endfor %}
  </div>

  {% if category.products.count > 6 %}
  <div class="show-more-container">
    <button class="btn-show-more" data-category="{{ category.id }}">Show More</button>
  </div>
  {% endif %}
</section>
{% endfor %}

<!-- JavaScript -->
<script>
document.addEventListener("DOMContentLoaded", function () {

    const filterButtons = document.querySelectorAll(".filter-btn");
    const categorySections = document.querySelectorAll(".category-section");

    function showAllCategories() {
        categorySections.forEach(section => {
            section.style.display = "block";
            const products = section.querySelectorAll(".product-card");
            const showMoreBtn = section.querySelector(".btn-show-more");
            products.forEach((product, index) => product.style.display = index < 6 ? "block" : "none");
            if (showMoreBtn) showMoreBtn.style.display = (products.length > 6) ? "inline-block" : "none";
        });
    }

    function showSingleCategory(categoryId) {
        categorySections.forEach(section => {
            const products = section.querySelectorAll(".product-card");
            const showMoreBtn = section.querySelector(".btn-show-more");
            if (section.dataset.category === categoryId) {
                section.style.display = "block";
                products.forEach(product => product.style.display = "block");
                if (showMoreBtn) showMoreBtn.style.display = "none";
            } else {
                section.style.display = "none";
            }
        });
    }

    // Filter Buttons
    filterButtons.forEach(btn => {
        btn.addEventListener("click", () => {
            filterButtons.forEach(b => b.classList.remove("active"));
            btn.classList.add("active");
            const category = btn.dataset.category;
            category === "all" ? showAllCategories() : showSingleCategory(category);
        });
    });

    // Show More Buttons
    document.querySelectorAll(".btn-show-more").forEach(btn => {
        btn.addEventListener("click", () => {
            const category = btn.dataset.category;
            filterButtons.forEach(b => b.classList.toggle("active", b.dataset.category === category));
            showSingleCategory(category);
        });
    });

    // URL Parameter Filter
    const params = new URLSearchParams(window.location.search);
    const categoryFromUrl = params.get("category");

    if (categoryFromUrl) {
        filterButtons.forEach(b => b.classList.toggle("active", b.dataset.category === categoryFromUrl));
        showSingleCategory(categoryFromUrl);
    } else {
        showAllCategories();
    }

    // Smooth scroll to anchor if present
    if (window.location.hash) {
        const target = document.querySelector(window.location.hash);
        if (target) {
            target.scrollIntoView({ behavior: "smooth", block: "start" });
        }
    }
});
</script>

{% endblock %}
